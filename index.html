<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IKEA Store 3D Tour</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5;}
.header{background:#0058a3;color:white;padding:20px 40px;display:flex;justify-content:space-between;align-items:center;}
.logo{font-size:2rem;font-weight:900;letter-spacing:2px;}
.info h2{font-size:1.2rem;margin:0;}
.container{max-width:1200px;margin:30px auto;padding:0 20px;}
#scene{width:100%;height:600px;background:#e8f4f8;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,0.15);position:relative;}
.controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;margin-top:20px;background:white;padding:20px;border-radius:8px;}
.ctrl{padding:15px;background:#f9f9f9;border-radius:6px;}
.ctrl h4{margin:0 0 8px;color:#0058a3;}
.legend{margin-top:20px;background:white;padding:20px;border-radius:8px;}
.legend h3{color:#0058a3;margin-top:0;}
.leg-item{display:flex;align-items:center;gap:10px;margin:8px 0;}
.color{width:30px;height:30px;border-radius:4px;}
.overlay{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:8px;box-shadow:0 12px 40px rgba(0,0,0,0.4);display:none;z-index:1000;max-width:400px;border-top:4px solid #ffda1a;}
.overlay h3{color:#0058a3;margin:0 0 15px;}
.overlay button{background:#0058a3;color:white;border:none;padding:10px 24px;border-radius:4px;cursor:pointer;margin-top:15px;}
.backdrop{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:999;}
</style>
</head>
<body>

<div class="header">
  <div class="logo">IKEA</div>
  <div class="info"><h2>3D Store Layout Presentation</h2></div>
</div>

<div class="container">
  <div id="scene"></div>
  
  <div class="controls">
    <div class="ctrl"><h4>üéÆ Move</h4>W/A/S/D keys<br>Shift = faster</div>
    <div class="ctrl"><h4>üëÅÔ∏è Look</h4>Drag mouse<br>Scroll to zoom</div>
    <div class="ctrl"><h4>‚ÑπÔ∏è Info</h4>Click blue signs<br>Click yellow dots</div>
    <div class="ctrl"><h4>üö∂ Auto Tour</h4>Press T key<br>Automatic walkthrough</div>
    <div class="ctrl"><h4>üîÑ Reset</h4>Press Space bar<br>Return to entrance</div>
  </div>

  <div class="legend">
    <h3>Store Sections</h3>
    <div class="leg-item"><div class="color" style="background:#0058a3"></div><strong>Entrance/Exit</strong> - Customer entry, info desk</div>
    <div class="leg-item"><div class="color" style="background:#d4a373"></div><strong>Showroom</strong> - Living room, bedroom displays</div>
    <div class="leg-item"><div class="color" style="background:#ffffff;border:1px solid #ddd"></div><strong>Marketplace</strong> - Accessories, small items</div>
    <div class="leg-item"><div class="color" style="background:#8b7355"></div><strong>Warehouse</strong> - Self-service pickup</div>
    <div class="leg-item"><div class="color" style="background:#ffda1a"></div><strong>Hotspots</strong> - Process information points</div>
  </div>
</div>

<div class="backdrop" id="backdrop"></div>
<div class="overlay" id="overlay">
  <h3 id="title">Info</h3>
  <p id="text">Details here</p>
  <button onclick="closeInfo()">Close</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
const wrap=document.getElementById('scene');
const scene=new THREE.Scene();
scene.background=new THREE.Color('#e8f4f8');
scene.fog=new THREE.Fog('#e8f4f8',40,120);

const camera=new THREE.PerspectiveCamera(70,wrap.clientWidth/wrap.clientHeight,0.1,200);
camera.position.set(0,2.5,40);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(wrap.clientWidth,wrap.clientHeight);
renderer.shadowMap.enabled=true;
wrap.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.7));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(20,30,20);
sun.castShadow=true;
scene.add(sun);

// Floor with texture pattern
const canvas=document.createElement('canvas');
canvas.width=canvas.height=512;
const ctx=canvas.getContext('2d');
ctx.fillStyle='#dcdcdc';
ctx.fillRect(0,0,512,512);
ctx.strokeStyle='#c0c0c0';
ctx.lineWidth=2;
for(let i=0;i<512;i+=64){
  ctx.beginPath();
  ctx.moveTo(i,0);
  ctx.lineTo(i,512);
  ctx.moveTo(0,i);
  ctx.lineTo(512,i);
  ctx.stroke();
}
const texture=new THREE.CanvasTexture(canvas);
texture.wrapS=texture.wrapT=THREE.RepeatWrapping;
texture.repeat.set(20,20);

const floor=new THREE.Mesh(
  new THREE.PlaneGeometry(120,120),
  new THREE.MeshStandardMaterial({map:texture,roughness:0.9})
);
floor.rotation.x=-Math.PI/2;
floor.receiveShadow=true;
scene.add(floor);

let clickables=[];

function wall(w,h,d,x,y,z,col){
  const m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),new THREE.MeshStandardMaterial({color:col}));
  m.position.set(x,y,z);
  m.castShadow=m.receiveShadow=true;
  scene.add(m);
  return m;
}

// Walls
wall(120,12,1,0,6,-60,'#e8e8e8');
wall(120,12,1,0,6,60,'#e8e8e8');
wall(1,12,120,-60,6,0,'#e8e8e8');
wall(1,12,120,60,6,0,'#e8e8e8');

// IKEA branding
const brand1=new THREE.Mesh(new THREE.PlaneGeometry(40,3),new THREE.MeshStandardMaterial({color:'#0058a3'}));
brand1.position.set(0,8,-59.9);
scene.add(brand1);

const brand2=new THREE.Mesh(new THREE.PlaneGeometry(40,1.2),new THREE.MeshStandardMaterial({color:'#ffda1a'}));
brand2.position.set(0,6,-59.9);
scene.add(brand2);

// Add texture to walls (wood panel effect for showroom)
function addTexture(mesh,color){
  const c=document.createElement('canvas');
  c.width=c.height=256;
  const ct=c.getContext('2d');
  ct.fillStyle=color;
  ct.fillRect(0,0,256,256);
  for(let i=0;i<30;i++){
    ct.strokeStyle=`rgba(0,0,0,${Math.random()*0.1})`;
    ct.lineWidth=Math.random()*2;
    ct.beginPath();
    ct.moveTo(0,Math.random()*256);
    ct.lineTo(256,Math.random()*256);
    ct.stroke();
  }
  const tex=new THREE.CanvasTexture(c);
  mesh.material.map=tex;
  mesh.material.needsUpdate=true;
}

function createTexture(baseColor,pattern){
  const canvas=document.createElement('canvas');
  canvas.width=canvas.height=512;
  const ctx=canvas.getContext('2d');
  ctx.fillStyle=baseColor;
  ctx.fillRect(0,0,512,512);
  
  if(pattern==='fabric'){
    for(let i=0;i<50;i++){
      ctx.strokeStyle=`rgba(0,0,0,${Math.random()*0.15})`;
      ctx.lineWidth=Math.random()*2;
      ctx.beginPath();
      ctx.moveTo(Math.random()*512,0);
      ctx.lineTo(Math.random()*512,512);
      ctx.stroke();
    }
    for(let i=0;i<50;i++){
      ctx.strokeStyle=`rgba(255,255,255,${Math.random()*0.1})`;
      ctx.lineWidth=Math.random();
      ctx.beginPath();
      ctx.moveTo(0,Math.random()*512);
      ctx.lineTo(512,Math.random()*512);
      ctx.stroke();
    }
  }else if(pattern==='wood'){
    for(let i=0;i<80;i++){
      ctx.strokeStyle=`rgba(101,67,33,${Math.random()*0.3})`;
      ctx.lineWidth=Math.random()*3+1;
      ctx.beginPath();
      ctx.moveTo(0,Math.random()*512);
      ctx.lineTo(512,Math.random()*512);
      ctx.stroke();
    }
  }else if(pattern==='metal'){
    const gradient=ctx.createLinearGradient(0,0,512,512);
    gradient.addColorStop(0,'rgba(255,255,255,0.2)');
    gradient.addColorStop(0.5,'rgba(0,0,0,0.1)');
    gradient.addColorStop(1,'rgba(255,255,255,0.2)');
    ctx.fillStyle=gradient;
    ctx.fillRect(0,0,512,512);
  }else if(pattern==='cardboard'){
    for(let i=0;i<100;i++){
      ctx.fillStyle=`rgba(139,115,85,${Math.random()*0.2})`;
      ctx.fillRect(Math.random()*512,Math.random()*512,Math.random()*20,Math.random()*20);
    }
  }
  
  return new THREE.CanvasTexture(canvas);
}

function product(x,y,z,w,h,d,col,name,desc,pattern){
  const texture=pattern?createTexture(col,pattern):null;
  const mat=texture?new THREE.MeshStandardMaterial({map:texture,roughness:0.7}):new THREE.MeshStandardMaterial({color:col,roughness:0.7});
  const m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),mat);
  m.position.set(x,y,z);
  m.castShadow=m.receiveShadow=true;
  m.userData={name,desc};
  scene.add(m);
  clickables.push(m);
  return m;
}

// Entrance
const entSign=wall(8,2,0.3,0,3,35,'#0058a3');
entSign.userData={name:'Store Entrance',desc:'Main entry with info desk. 15,000+ weekly visitors. Store maps and member services available.'};
clickables.push(entSign);
product(-8,0.5,38,3,1,2,'#8b4513','Reception Desk','Customer service & information','wood');

// Living Room Showroom
for(let i=0;i<3;i++){
  const x=-25+i*10;
  product(x,0.5,0,4,1,2.5,'#8b6f47','Sofa Set '+(i+1),'3-seat sofa $699-$1299','fabric');
  product(x-2,0.3,3,1.5,0.6,1.5,'#654321','Coffee Table','Wood $149','wood');
  product(x+3,1.2,0,0.8,2.5,0.5,'#2c3e50','TV Stand','$199','wood');
}

const livSign=wall(6,1.5,0.2,-20,4,-10,'#3498db');
livSign.userData={name:'Living Room',desc:'Complete living room displays. Test furniture comfort. Staff consultations available.'};
clickables.push(livSign);

// Bedroom
for(let i=0;i<2;i++){
  const x=15+i*12;
  product(x,1,5,4,2,5,'#c19a6b','Bed Frame '+(i+1),'Queen with storage $399','wood');
  product(x+4,0.8,5,1.5,1.8,1.2,'#8b7355','Nightstand','2-drawer $79','wood');
  product(x-4,2,5,2,4,1.5,'#f5f5dc','Wardrobe','3-door $599','wood');
}

const bedSign=wall(6,1.5,0.2,20,4,-5,'#3498db');
bedSign.userData={name:'Bedroom',desc:'Complete bedroom solutions. Mattress testing area. Sleep specialists available.'};
clickables.push(bedSign);

// Kitchen
product(-20,0.5,25,8,1,3,'#ffffff','Kitchen Unit','Complete kitchen $1,299','metal');
product(-20,1.5,22,2,3,2,'#e5e5e5','Refrigerator','$499','metal');

const kitSign=wall(6,1.5,0.2,-20,4,15,'#3498db');
kitSign.userData={name:'Kitchen',desc:'Modular systems. Free 3D design service. Planning appointments available.'};
clickables.push(kitSign);

// Office
for(let i=0;i<3;i++){
  const x=12+i*8;
  product(x,0.8,25,3.5,1.6,2,'#34495e','Desk '+(i+1),'Height adjustable $299','wood');
  product(x,1.8,27,1.2,2.2,1.2,'#2c3e50','Office Chair','Ergonomic $249','fabric');
}

const offSign=wall(6,1.5,0.2,20,4,15,'#3498db');
offSign.userData={name:'Office',desc:'Home office solutions. Ergonomic furniture. Business bulk orders available.'};
clickables.push(offSign);

// Marketplace
for(let x=-15;x<20;x+=8){
  for(let z=42;z<50;z+=4){
    product(x,0.5,z,3,1,2,'#f0f0f0','Display','Accessories & textiles','fabric');
  }
}

const markSign=wall(8,1.5,0.2,0,4,40,'#3498db');
markSign.userData={name:'Marketplace',desc:'Self-service small items. Kitchen accessories, textiles, decor. High-margin products.'};
clickables.push(markSign);

// Warehouse
for(let x=35;x<55;x+=5){
  for(let z=43;z<52;z+=4){
    product(x,2,z,3,4,3,'#8b7355','Stock','Flat-pack furniture','cardboard');
  }
}

const wareSign=wall(8,1.5,0.2,45,4,38,'#3498db');
wareSign.userData={name:'Warehouse',desc:'Self-service pickup. Products by aisle/bin. Real-time stock via app. Trolleys available.'};
clickables.push(wareSign);

// Checkout
for(let i=0;i<5;i++){
  product(-12+i*6,0.6,54,2.5,1.2,1,'#0058a3','Checkout '+(i+1),'Card/cash/mobile pay','metal');
}

const checkSign=wall(8,1.5,0.2,0,4,50,'#3498db');
checkSign.userData={name:'Checkout',desc:'Multiple lanes. Self-checkout available. Avg transaction: 3-4 min. Family card benefits.'};
clickables.push(checkSign);

// Hotspots (yellow spheres)
function hotspot(x,y,z,name,info){
  const m=new THREE.Mesh(new THREE.SphereGeometry(0.4,16,16),new THREE.MeshStandardMaterial({color:'#ffda1a',emissive:'#ffda1a',emissiveIntensity:0.6}));
  m.position.set(x,y,z);
  m.userData={name,desc:info};
  scene.add(m);
  clickables.push(m);
  let s=1,d=1;
  setInterval(()=>{s+=d*0.015;if(s>1.25)d=-1;if(s<1)d=1;m.scale.setScalar(s);},40);
}

hotspot(0,2,38,'Entry Point','Main entrance. Store maps provided. Peak: 11am-2pm, 5pm-7pm.');
hotspot(-20,2,0,'Showroom Flow','Floor arrows guide customers. Avg 45-60 min in showrooms.');
hotspot(20,2,5,'Product Info','Price tags, codes, QR for catalog. Staff tablets for stock check.');
hotspot(0,2,45,'Marketplace Entry','Natural flow from showroom. Food market adjacent.');
hotspot(45,2,48,'Warehouse Access','Note aisle/bin from tags. Self-service with assistance.');
hotspot(0,2,54,'Exit Process','Queue management. Cart return after payment.');

// Customer path line
const pts=[
  new THREE.Vector3(0,0.1,35),
  new THREE.Vector3(-20,0.1,15),
  new THREE.Vector3(-25,0.1,0),
  new THREE.Vector3(0,0.1,-5),
  new THREE.Vector3(25,0.1,5),
  new THREE.Vector3(20,0.1,25),
  new THREE.Vector3(0,0.1,42),
  new THREE.Vector3(45,0.1,46),
  new THREE.Vector3(0,0.1,54)
];
const pathGeo=new THREE.BufferGeometry().setFromPoints(pts);
const path=new THREE.Line(pathGeo,new THREE.LineBasicMaterial({color:'#ffda1a',linewidth:2}));
scene.add(path);

// Controls
let mouseDown=false,lastX=0,lastY=0;
renderer.domElement.addEventListener('mousedown',e=>{mouseDown=true;lastX=e.clientX;lastY=e.clientY;});
window.addEventListener('mouseup',()=>mouseDown=false);
renderer.domElement.addEventListener('mousemove',e=>{
  if(mouseDown){
    camera.rotation.y-=(e.clientX-lastX)*0.003;
    camera.rotation.x-=(e.clientY-lastY)*0.003;
    camera.rotation.x=Math.max(-Math.PI/3,Math.min(Math.PI/3,camera.rotation.x));
    lastX=e.clientX;lastY=e.clientY;
  }
});

const keys={};
let autoWalk=false;
let walkIndex=0;
const walkPath=[
  {pos:[0,2.5,40],look:[0,2.5,35]},
  {pos:[0,2.5,30],look:[0,2.5,20]},
  {pos:[-10,2.5,20],look:[-20,2.5,15]},
  {pos:[-20,2.5,10],look:[-25,2.5,0]},
  {pos:[-25,2.5,0],look:[-25,2.5,-5]},
  {pos:[-20,2.5,-5],look:[0,2.5,-5]},
  {pos:[0,2.5,-5],look:[20,2.5,0]},
  {pos:[20,2.5,5],look:[25,2.5,5]},
  {pos:[25,2.5,10],look:[20,2.5,20]},
  {pos:[20,2.5,25],look:[10,2.5,25]},
  {pos:[0,2.5,30],look:[0,2.5,40]},
  {pos:[0,2.5,42],look:[20,2.5,45]},
  {pos:[30,2.5,45],look:[45,2.5,48]},
  {pos:[45,2.5,48],look:[45,2.5,50]},
  {pos:[30,2.5,50],look:[0,2.5,52]},
  {pos:[0,2.5,54],look:[0,2.5,56]}
];

window.addEventListener('keydown',e=>{
  keys[e.key.toLowerCase()]=true;
  if(e.key===' '){camera.position.set(0,2.5,40);camera.rotation.set(0,0,0);autoWalk=false;walkIndex=0;}
  if(e.key.toLowerCase()==='t'){autoWalk=!autoWalk;walkIndex=0;}
});
window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

function smoothMove(from,to,progress){
  return from+(to-from)*progress;
}

function move(){
  if(autoWalk){
    const step=walkPath[walkIndex];
    const nextStep=walkPath[Math.min(walkIndex+1,walkPath.length-1)];
    const speed=0.02;
    
    camera.position.x=smoothMove(camera.position.x,step.pos[0],speed);
    camera.position.y=smoothMove(camera.position.y,step.pos[1],speed);
    camera.position.z=smoothMove(camera.position.z,step.pos[2],speed);
    
    const lookAt=new THREE.Vector3(step.look[0],step.look[1],step.look[2]);
    camera.lookAt(lookAt);
    
    const dist=Math.sqrt(
      Math.pow(camera.position.x-step.pos[0],2)+
      Math.pow(camera.position.z-step.pos[2],2)
    );
    
    if(dist<0.5){
      walkIndex++;
      if(walkIndex>=walkPath.length){
        walkIndex=0;
      }
    }
  }else{
    const speed=keys.shift?0.3:0.15;
    const dir=new THREE.Vector3();
    camera.getWorldDirection(dir);
    dir.y=0;
    dir.normalize();
    const right=new THREE.Vector3().crossVectors(camera.up,dir).normalize();
    if(keys.w)camera.position.addScaledVector(dir,speed);
    if(keys.s)camera.position.addScaledVector(dir,-speed);
    if(keys.a)camera.position.addScaledVector(right,speed);
    if(keys.d)camera.position.addScaledVector(right,-speed);
    camera.position.y=Math.max(1.5,camera.position.y);
  }
}

renderer.domElement.addEventListener('wheel',e=>{
  e.preventDefault();
  camera.fov+=e.deltaY*0.05;
  camera.fov=Math.max(30,Math.min(90,camera.fov));
  camera.updateProjectionMatrix();
});

// Click interaction
const raycaster=new THREE.Raycaster();
const mouse=new THREE.Vector2();
renderer.domElement.addEventListener('click',e=>{
  const rect=wrap.getBoundingClientRect();
  mouse.x=((e.clientX-rect.left)/rect.width)*2-1;
  mouse.y=-((e.clientY-rect.top)/rect.height)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hits=raycaster.intersectObjects(clickables);
  if(hits.length){
    const obj=hits[0].object;
    if(obj.userData.name){
      document.getElementById('title').textContent=obj.userData.name;
      document.getElementById('text').textContent=obj.userData.desc;
      document.getElementById('overlay').style.display='block';
      document.getElementById('backdrop').style.display='block';
    }
  }
});

function closeInfo(){
  document.getElementById('overlay').style.display='none';
  document.getElementById('backdrop').style.display='none';
}

window.addEventListener('resize',()=>{
  camera.aspect=wrap.clientWidth/wrap.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(wrap.clientWidth,wrap.clientHeight);
});

function animate(){
  requestAnimationFrame(animate);
  move();
  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
