<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Authentic IKEA Store 3D Tour - One-Way Layout</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
body {font-family:Arial,sans-serif;background:#f5f5f5;overflow:hidden;}
#loading {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,88,163,0.95);color:white;padding:30px;border-radius:12px;text-align:center;z-index:10000;display:flex;flex-direction:column;gap:20px;}
progress {width:200px;height:10px;}
.header {position:fixed;top:0;left:0;right:0;background:linear-gradient(135deg,#0058a3,#003d7a);color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;z-index:100;box-shadow:0 4px 20px rgba(0,88,163,0.3);}
.logo {font-size:1.8rem;font-weight:900;letter-spacing:2px;text-shadow:2px 2px 4px rgba(0,0,0,0.3);}
#scene {width:100vw;height:100vh;background:#e8f4f8;}
#hud {position:fixed;bottom:20px;right:20px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);padding:15px;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.2);font-size:0.9rem;max-width:300px;display:none;}
.controls {position:fixed;top:20px;right:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);padding:15px;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.2);}
.ctrl {padding:10px;background:rgba(249,249,249,0.8);border-radius:8px;text-align:center;font-size:0.85rem;}
.ctrl h4 {margin:0 0 5px;color:#0058a3;font-size:0.9rem;}
#fps {position:fixed;top:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:5px 10px;border-radius:4px;font-family:monospace;font-size:0.8rem;}
#crosshair {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:20px;height:20px;border:2px solid rgba(255,255,255,0.8);border-radius:50%;pointer-events:none;z-index:99;display:none;}
.overlay{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.4);display:none;z-index:1001;max-width:450px;border-top:5px solid #ffda1a;max-height:80vh;overflow-y:auto;}
.overlay h3{color:#0058a3;margin:0 0 15px;font-size:1.4rem;}
.overlay button{background:#0058a3;color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;margin-top:15px;font-weight:500;transition:all 0.3s;}
.overlay button:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,88,163,0.4);}
#joystick {position:fixed;bottom:30px;left:30px;width:100px;height:100px;background:rgba(0,88,163,0.2);border-radius:50%;display:none;touch-action:none;}
#joystick-knob {position:absolute;width:40px;height:40px;background:#0058a3;border-radius:50%;transition:all 0.1s;}
@media (max-width:768px) {.controls{display:none;}#joystick{display:block;}}
</style>
</head>
<body>
<div id="loading">
  <div>üõí Loading Authentic IKEA Layout...</div>
  <progress max="100" value="0"></progress>
  <div id="loadText">Creating one-way showroom path...</div>
</div>

<div class="header">
  <div class="logo">IKEA 3D‚Ä¢Authentic</div>
  <div>
    <button id="toggleFP" style="background:none;color:white;border:1px solid white;padding:8px 16px;border-radius:20px;margin-left:10px;cursor:pointer;">üëÅÔ∏è 1st Person</button>
    <button id="autoTour" style="background:#ffda1a;color:#0058a3;border:none;padding:8px 16px;border-radius:20px;font-weight:600;cursor:pointer;">üö∂ Follow Path</button>
  </div>
</div>

<div class="controls">
  <div class="ctrl"><h4>üéÆ Move</h4>WASD / Arrow Keys<br>Follow Blue Path</div>
  <div class="ctrl"><h4>üëÄ Look</h4>Mouse Drag<br>Touch Drag</div>
  <div class="ctrl"><h4>‚ÑπÔ∏è Info</h4>Click Room Displays<br>Touch Products</div>
  <div class="ctrl"><h4>üè† Home</h4>SPACEBAR<br>Return Entrance</div>
</div>

<div id="fps">FPS: --</div>
<div id="crosshair"></div>

<div id="joystick"><div id="joystick-knob"></div></div>

<div class="overlay" id="overlay">
  <h3 id="title">IKEA Showroom</h3>
  <p id="text" style="line-height:1.6;">Explore our authentic one-way store layout designed to guide you through every department just like a real IKEA!</p>
  <div id="priceAnim" style="font-size:2rem;font-weight:bold;color:#0058a3;margin:15px 0;text-align:center;"></div>
  <button onclick="closeInfo()">Continue Shopping √ó</button>
</div>

<div id="scene"></div>

<script>
// AUTHENTIC IKEA STORE LAYOUT - ONE-WAY MAZE PATH
// Features real IKEA showroom flow: Entrance ‚Üí Living ‚Üí Bedroom ‚Üí Kitchen ‚Üí Dining ‚Üí Market ‚Üí Checkout

class AuthenticIKEAStore {
  constructor() {
    this.scene = null;
    this.camera = null;
    this.renderer = null;
    this.clock = new THREE.Clock();
    this.keys = {};
    this.isFP = false;
    this.autoTour = false;
    this.pathProgress = 0;
    this.fps = 0;
    this.lastTime = 0;
    this.speed = 0.15;
    this.colliders = [];
    this.clickables = [];
    this.showrooms = {};
    this.customers = [];
    
    this.init();
    this.createAuthenticLayout();
    this.setupControls();
    this.animate();
  }

  init() {
    const container = document.getElementById('scene');
    
    this.scene = new THREE.Scene();
    this.scene.background = new THREE.Color(0xf0f8ff);
    this.scene.fog = new THREE.Fog(0xe8f4f8, 30, 120);
    
    this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 200);
    this.camera.position.set(-5, 1.8, 8);
    
    this.renderer = new THREE.WebGLRenderer({ antialias: true });
    this.renderer.setSize(window.innerWidth, window.innerHeight);
    this.renderer.shadowMap.enabled = true;
    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    container.appendChild(this.renderer.domElement);
    
    // IKEA showroom lighting
    const ambient = new THREE.AmbientLight(0xffffff, 0.7);
    this.scene.add(ambient);
    
    const ceilingLights = new THREE.DirectionalLight(0xfff8e8, 0.8);
    ceilingLights.position.set(0, 15, 0);
    ceilingLights.castShadow = true;
    this.scene.add(ceilingLights);
  }

  createAuthenticLayout() {
    // === IKEA ONE-WAY PATH (ENTRANCE ‚Üí SHOWROOMS ‚Üí MARKET ‚Üí WAREHOUSE) ===
    
    // 1. MAIN ENTRANCE AREA (Z=0)
    this.createEntrance();
    
    // 2. LIVING ROOM SHOWROOM (Z=8‚Üí20) - Multiple room setups
    this.createLivingRoomShowroom();
    
    // 3. BEDROOM SHOWROOM (Z=22‚Üí32) - Beds, wardrobes
    this.createBedroomShowroom();
    
    // 4. KITCHEN/DINING (Z=34‚Üí44)
    this.createKitchenDining();
    
    // 5. MARKET HALL (Z=46‚Üí52) - Small items
    this.createMarketHall();
    
    // 6. WAREHOUSE (Z=54‚Üí65) - Flatpacks
    this.createWarehouse();
    
    // 7. CHECKOUT (Z=67‚Üí72)
    this.createCheckout();
    
    // ONE-WAY GUIDING PATH (wide blue road)
    this.createIKEAOneWayPath();
    
    // Room dividers & signage
    this.createRoomDividers();
  }

  createEntrance() {
    // Welcome archway
    const archGeo = new THREE.CylinderGeometry(0.3, 0.3, 6, 8);
    const archMat = new THREE.MeshStandardMaterial({color: '#0058a3'});
    const archLeft = new THREE.Mesh(archGeo, archMat);
    archLeft.position.set(-3, 3, 1);
    archLeft.rotation.z = Math.PI / 4;
    this.scene.add(archLeft);
    
    const archRight = new THREE.Mesh(archGeo, archMat);
    archRight.position.set(3, 3, 1);
    archRight.rotation.z = -Math.PI / 4;
    this.scene.add(archRight);
    
    // Welcome sign
    this.createSign('üëã WELCOME', 0, 5, 0, '#ffda1a', true);
    
    // Info desk
    const desk = new THREE.Mesh(
      new THREE.BoxGeometry(4, 1.2, 2),
      new THREE.MeshStandardMaterial({color: '#8b7355'})
    );
    desk.position.set(0, 0.6, 4);
    desk.castShadow = true;
    this.scene.add(desk);
  }

  createLivingRoomShowroom() {
    // 6+ complete living room setups along path
    const livingRooms = [
      {x:-8, z:12}, {x:-2, z:14}, {x:4, z:16},
      {x:10, z:18}, {x:-5, z:20}, {x:6, z:22}
    ];
    
    livingRooms.forEach((room, i) => {
      // Sofa setups
      this.createSofaRoom(room.x, room.z);
      
      // Rug
      const rug = new THREE.Mesh(
        new THREE.PlaneGeometry(5, 3),
        new THREE.MeshStandardMaterial({color: '#8b4513'})
      );
      rug.rotation.x = -Math.PI/2;
      rug.position.set(room.x, 0.01, room.z);
      this.scene.add(rug);
      
      // Section label
      this.createSign('LIVING ROOM', room.x, 4.5, room.z-1, '#d4a373');
    });
  }

  createSofaRoom(x, z) {
    // Complete room: sofa + table + lamp + TV
    const sofa = new THREE.Mesh(
      new THREE.BoxGeometry(3.5, 1, 2),
      new THREE.MeshStandardMaterial({color: '#8b6f47'})
    );
    sofa.position.set(x, 0.5, z+1.5);
    sofa.castShadow = true;
    this.scene.add(sofa);
    
    // Coffee table
    const table = new THREE.Mesh(
      new THREE.BoxGeometry(1.5, 0.4, 1),
      new THREE.MeshStandardMaterial({color: '#654321'})
    );
    table.position.set(x, 0.2, z+0.5);
    table.castShadow = true;
    this.scene.add(table);
    
    // Floor lamp
    const lampBase = new THREE.Mesh(
      new THREE.CylinderGeometry(0.15, 0.2, 1.5),
      new THREE.MeshStandardMaterial({color: '#444'})
    );
    lampBase.position.set(x-2, 0.75, z);
    this.scene.add(lampBase);
    
    const lampShade = new THREE.Mesh(
      new THREE.ConeGeometry(0.4, 0.6, 8),
      new THREE.MeshStandardMaterial({color: '#f5f5f5', emissive: '#ffaa00', emissiveIntensity: 0.3})
    );
    lampShade.position.set(x-2, 2.2, z);
    this.scene.add(lampShade);
    
    this.clickables.push(sofa);
  }

  createBedroomShowroom() {
    const beds = [
      {x:-6, z:26}, {x:2, z:28}, {x:8, z:30},
      {x:-3, z:32}
    ];
    
    beds.forEach(bedPos => {
      // Bed frame
      const bed = new THREE.Mesh(
        new THREE.BoxGeometry(4, 1.2, 6),
        new THREE.MeshStandardMaterial({color: '#c19a6b'})
      );
      bed.position.set(bedPos.x, 0.6, bedPos.z);
      this.scene.add(bed);
      
      // Mattress
      const mattress = new THREE.Mesh(
        new THREE.BoxGeometry(3.6, 0.6, 5.5),
        new THREE.MeshStandardMaterial({color: '#f0f0f0'})
      );
      mattress.position.set(bedPos.x, 1.3, bedPos.z);
      this.scene.add(mattress);
      
      // Pillows
      for(let p=0; p<2; p++) {
        const pillow = new THREE.Mesh(
          new THREE.BoxGeometry(1, 0.4, 0.8),
          new THREE.MeshStandardMaterial({color: '#e8e8e8'})
        );
        pillow.position.set(bedPos.x - 0.8 + p*1.6, 1.7, bedPos.z - 1.5);
        this.scene.add(pillow);
      }
    });
    
    this.createSign('BEDROOM', 0, 4.5, 28, '#f5e6d3');
  }

  createKitchenDining() {
    // Kitchen islands (x=-8 to x=8, z=36‚Üí42)
    for(let i=0; i<4; i++) {
      const kitchenX = -6 + i*3.5;
      const kitchen = new THREE.Mesh(
        new THREE.BoxGeometry(3, 2.2, 2.5),
        new THREE.MeshStandardMaterial({color: '#ffffff'})
      );
      kitchen.position.set(kitchenX, 1.1, 39);
      this.scene.add(kitchen);
      
      // Countertop
      const counter = new THREE.Mesh(
        new THREE.BoxGeometry(3.2, 0.1, 2.7),
        new THREE.MeshStandardMaterial({color: '#8b8b8b'})
      );
      counter.position.set(kitchenX, 2.25, 39);
      this.scene.add(counter);
    }
    
    // Dining tables
    for(let i=0; i<3; i++) {
      const tableX = -5 + i*5;
      const table = new THREE.Mesh(
        new THREE.BoxGeometry(2.5, 0.8, 2.5),
        new THREE.MeshStandardMaterial({color: '#8b7355'})
      );
      table.position.set(tableX, 0.4, 43);
      this.scene.add(table);
      
      // Chairs around table
      for(let c=0; c<4; c++) {
        const chair = new THREE.Mesh(
          new THREE.BoxGeometry(0.6, 1, 0.6),
          new THREE.MeshStandardMaterial({color: '#d4a373'})
        );
        const angle = (c/4) * Math.PI * 2;
        chair.position.set(
          tableX + Math.cos(angle) * 1.6,
          0.3,
          43 + Math.sin(angle) * 1.6
        );
        this.scene.add(chair);
      }
    }
    
    this.createSign('KITCHEN & DINING', 0, 4.5, 40, '#e8e8e8');
  }

  createMarketHall() {
    // Small item displays (shelves packed tightly)
    for(let x=-12; x<=12; x+=2.5) {
      for(let z=47; z<=51; z+=1.2) {
        const shelf = new THREE.Mesh(
          new THREE.BoxGeometry(1.8, 2.5, 0.8),
          new THREE.MeshStandardMaterial({color: '#f8f8f8'})
        );
        shelf.position.set(x, 1.25, z);
        shelf.castShadow = true;
        this.scene.add(shelf);
        
        // Products on shelves
        const product = new THREE.Mesh(
          new THREE.BoxGeometry(0.4, 0.4, 0.4),
          new THREE.MeshStandardMaterial({color: '#ff6b6b'})
        );
        product.position.set(x, 2.1, z);
        this.scene.add(product);
      }
    }
    
    this.createSign('MARKET HALL', 0, 3.5, 49, '#ffffff');
  }

  createWarehouse() {
    // Flatpack boxes stacked high (real IKEA warehouse feel)
    for(let x=38; x<=55; x+=2.5) {
      for(let z=55; z<=64; z+=2.2) {
        for(let stack=0; stack<3; stack++) {
          const box = new THREE.Mesh(
            new THREE.BoxGeometry(2, 0.8, 1.5),
            new THREE.MeshStandardMaterial({color: '#8b7355'})
          );
          box.position.set(x, 0.4 + stack*0.9, z);
          box.castShadow = true;
          this.scene.add(box);
        }
      }
    }
    
    this.createSign('SELF SERVE', 46, 4, 59, '#8b7355');
  }

  createCheckout() {
    // Checkout counters
    for(let i=0; i<6; i++) {
      const counter = new THREE.Mesh(
        new THREE.BoxGeometry(2.5, 1.2, 1.5),
        new THREE.MeshStandardMaterial({color: '#0058a3'})
      );
      counter.position.set(-10 + i*3.5, 0.6, 70);
      counter.castShadow = true;
      this.scene.add(counter);
    }
    
    // EXIT sign
    this.createSign('EXIT ‚Üí', 0, 5, 71, '#d32f2f', true);
  }

  createIKEAOneWayPath() {
    // THICK BLUE GUIDING PATH - Real IKEA feature
    const pathPoints = [];
    for(let z=1; z<=72; z+=0.5) {
      pathPoints.push(new THREE.Vector3(-12, 0.02, z));
      pathPoints.push(new THREE.Vector3(12, 0.02, z));
    }
    
    const pathGeometry = new THREE.BufferGeometry().setFromPoints(pathPoints);
    const pathMaterial = new THREE.MeshBasicMaterial({
      color: '#0058a3',
      transparent: true,
      opacity: 0.7
    });
    const path = new THREE.Line(pathGeometry, pathMaterial);
    path.rotation.x = -Math.PI/2;
    this.scene.add(path);
  }

  createRoomDividers() {
    // Low walls between showrooms (IKEA style)
    const dividers = [
      {x:-15, z:21, w:30, h:1.5}, // Living‚ÜíBedroom
      {x:-15, z:33, w:30, h:1.5}, // Bedroom‚ÜíKitchen
      {x:-15, z:45, w:30, h:2},   // Kitchen‚ÜíMarket
      {x:38, z:54, w:20, h:2.5}   // Market‚ÜíWarehouse
    ];
    
    dividers.forEach(d => {
      const divider = new THREE.Mesh(
        new THREE.BoxGeometry(d.w, d.h, 0.3),
        new THREE.MeshStandardMaterial({color: '#d4d4d4'})
      );
      divider.position.set(d.x, d.h/2, d.z);
      divider.castShadow = true;
      this.scene.add(divider);
    });
  }

  createSign(text, x, y, z, color, emissive=false) {
    const canvas = document.createElement('canvas');
    canvas.width = 512; canvas.height = 128;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = color;
    ctx.fillRect(0,0,512,128);
    ctx.fillStyle = 'white';
    ctx.font = 'bold 60px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(text, 256, 80);
    
    const texture = new THREE.CanvasTexture(canvas);
    const sign = new THREE.Mesh(
      new THREE.PlaneGeometry(6, 1.5),
      new THREE.MeshBasicMaterial({map: texture, transparent: true})
    );
    sign.position.set(x, y, z);
    if(emissive) sign.material.emissive = new THREE.Color(0x444444);
    this.scene.add(sign);
    this.clickables.push(sign);
  }

  setupControls() {
    document.addEventListener('keydown', (e) => {
      this.keys[e.code] = true;
      if(e.code === 'Space') {
        this.camera.position.set(-5, 1.8, 8);
        e.preventDefault();
      }
      if(e.code === 'KeyT') this.autoTour = !this.autoTour;
    });
    
    document.addEventListener('keyup', (e) => this.keys[e.code] = false);
    
    // Mouse look (first person)
    let mouseX = 0, mouseY = 0;
    document.addEventListener('mousemove', (e) => {
      if(this.isFP) {
        mouseX -= e.movementX * 0.002;
        mouseY -= e.movementY * 0.002;
        mouseY = Math.max(-Math.PI/2, Math.min(Math.PI/2, mouseY));
        this.camera.rotation.y = mouseX;
        this.camera.rotation.x = mouseY;
      }
    });
    
    document.getElementById('toggleFP').onclick = () => {
      this.isFP = !this.isFP;
      document.getElementById('crosshair').style.display = this.isFP ? 'block' : 'none';
    };
    
    document.getElementById('autoTour').onclick = () => {
      this.autoTour = !this.autoTour;
      document.getElementById('autoTour').textContent = this.autoTour ? '‚èπÔ∏è Stop' : 'üö∂ Follow Path';
    };
    
    window.addEventListener('resize', () => {
      this.camera.aspect = window.innerWidth / window.innerHeight;
      this.camera.updateProjectionMatrix();
      this.renderer.setSize(window.innerWidth, window.innerHeight);
    });
  }

  animate() {
    requestAnimationFrame(() => this.animate());
    
    const delta = this.clock.getDelta();
    const time = this.clock.getElapsedTime();
    
    // Movement along ONE-WAY PATH
    const forward = new THREE.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion);
    let moveSpeed = this.speed;
    
    if(this.keys['KeyW'] || this.keys['ArrowUp']) {
      this.camera.position.add(forward.multiplyScalar(moveSpeed));
    }
    if(this.keys['KeyS'] || this.keys['ArrowDown']) {
      this.camera.position.add(forward.multiplyScalar(-moveSpeed * 0.5));
    }
    
    // Auto-tour follows authentic IKEA path
    if(this.autoTour) {
      const pathZ = 8 + (this.pathProgress % 64);
      this.camera.position.lerp(new THREE.Vector3(0, 1.8, pathZ), 0.04);
      this.pathProgress += delta * 8;
    }
    
    // Animate customers (wandering showroom)
    this.customers.forEach(customer => {
      customer.rotation.y += delta * 0.5;
      customer.position.x += Math.sin(time * 2 + customer.userData.offset) * 0.02;
    });
    
    // FPS
    if(time - this.lastTime > 1) {
      this.fps = Math.round(1 / (time - this.lastTime));
      document.getElementById('fps').textContent = `FPS: ${this.fps}`;
      this.lastTime = time;
      document.getElementById('loading').style.display = 'none';
    }
    
    this.renderer.render(this.scene, this.camera);
  }
}

// Global handlers
function closeInfo() {
  document.getElementById('overlay').style.display = 'none';
}

document.addEventListener('click', (e) => {
  const rect = e.target.getBoundingClientRect();
  store.mouse.x = (e.clientX - rect.left) / rect.width * 2 - 1;
  store.mouse.y = -(e.clientY - rect.top) / rect.height * 2 + 1;
  
  store.raycaster.setFromCamera(store.mouse, store.camera);
  const intersects = store.raycaster.intersectObjects(store.clickables);
  if(intersects.length > 0) {
    document.getElementById('overlay').style.display = 'block';
  }
});

// Start authentic IKEA experience
const store = new AuthenticIKEAStore();
</script>
</body>
</html>

